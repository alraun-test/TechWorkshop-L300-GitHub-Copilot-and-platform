@model ZavaStorefront.Models.ChatViewModel
@{
    ViewData["Title"] = "Chat";
}

<div class="container mt-4">
    <h1 class="mb-4"><i class="bi bi-chat-dots"></i> Chat with Zava Assistant</h1>

    <div class="row">
        <div class="col-md-8 col-lg-9">
            <div class="card">
                <div class="card-body">
                    <div id="chat-messages" style="height: 400px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.375rem; padding: 1rem; margin-bottom: 1rem; background-color: #f8f9fa;">
                        @if (Model.Messages.Count == 0 || Model.Messages.All(m => m.Role == "system"))
                        {
                            <div class="text-center text-muted mt-5">
                                <i class="bi bi-chat-dots" style="font-size: 3rem;"></i>
                                <p class="mt-3">Start a conversation by typing a message below.</p>
                            </div>
                        }
                        else
                        {
                            @foreach (var message in Model.Messages.Where(m => m.Role != "system"))
                            {
                                <div class="mb-3 @(message.Role == "user" ? "text-end" : "text-start")">
                                    <div class="d-inline-block p-2 rounded @(message.Role == "user" ? "bg-primary text-white" : "bg-white border")"
                                         style="max-width: 80%; text-align: left;">
                                        <small class="fw-bold">@(message.Role == "user" ? "You" : "Assistant")</small>
                                        <div>@message.Content</div>
                                    </div>
                                </div>
                            }
                        }
                    </div>

                    <form asp-action="SendMessage" method="post">
                        <div class="input-group">
                            <input type="text" name="UserMessage" class="form-control" placeholder="Type your message..."
                                   autofocus autocomplete="off" />
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-send"></i> Send
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <form asp-action="ClearChat" method="post" class="mt-2">
                <button type="submit" class="btn btn-outline-secondary btn-sm">
                    <i class="bi bi-trash"></i> Clear Chat
                </button>
            </form>
        </div>

        <div class="col-md-4 col-lg-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">About</h5>
                    <p class="card-text">This chatbot is powered by the <strong>Phi-4</strong> model via Microsoft Foundry. Ask questions about products, pricing, or anything else!</p>
                    <hr />
                    <h6>Try asking:</h6>
                    <ul class="list-unstyled">
                        <li class="mb-1"><small>"What products do you have?"</small></li>
                        <li class="mb-1"><small>"Tell me about headphones"</small></li>
                        <li class="mb-1"><small>"What's the cheapest item?"</small></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Auto-scroll to bottom of chat messages
        var chatMessages = document.getElementById('chat-messages');
        if (chatMessages) {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    </script>
}
